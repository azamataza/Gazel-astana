<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Магазин — Упаковочные материалы</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>

  body { font-family: 'Open Sans', sans-serif; margin:0; background:#f0f4f8; color:#222; -webkit-font-smoothing:antialiased; }
  .floating-header { position:fixed; top:0; left:0; right:0; background:rgba(26,35,126,0.98); color:#fff; display:flex;align-items:center;justify-content:space-between;padding:12px 18px; z-index:1000; box-shadow:0 4px 18px rgba(10,20,40,0.2); }
  .floating-header .left { display:flex;align-items:center;gap:12px;}
  .floating-header a, .floating-header .shop-btn { color:#fff; text-decoration:none; display:inline-flex; align-items:center; gap:8px; font-family:'Montserrat',sans-serif;}
  .container { max-width:1100px; margin:110px auto 80px; padding:0 16px; }
  header.main-head { text-align:center; padding:28px 14px; background:linear-gradient(180deg, rgba(26,35,126,0.95), rgba(26,35,126,0.88)); color:#fff; border-radius:8px; box-shadow:0 6px 20px rgba(26,35,126,0.06); }
  h1 { font-family:'Montserrat',sans-serif; margin:0 0 8px; font-size:1.9rem; }
  p.lead { margin:0; opacity:0.95; }
  .category { margin-top:28px; }
  .category h2 { font-family:'Montserrat',sans-serif; color:#1a237e; margin-bottom:12px; font-size:1.4rem; }
  .cards { display:grid; grid-template-columns: repeat(auto-fill,minmax(240px,1fr)); gap:14px; }
  .card { background:#fff; padding:14px; border-radius:12px; box-shadow:0 8px 22px rgba(20,30,60,0.06); display:flex; flex-direction:column; gap:8px; min-height:120px; }
  .card .meta { color:#6c757d; font-size:0.95rem; }
  .price-row { display:flex; align-items:center; justify-content:space-between; gap:8px; margin-top:6px; }
  .price { font-weight:800; color:#ff9900; font-size:1.06rem; }
  .add-controls { display:flex; gap:8px; align-items:center; }
  .btn { background:#1a237e; color:#fff; border:none; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:700; font-family:'Montserrat',sans-serif; }
  .btn.whatsapp { background:#25D366; color:#fff; display:inline-flex; gap:8px; align-items:center; }
  .small { background:#f1f3f8;border:1px solid #e4e7ef;padding:8px 10px;border-radius:8px; cursor:pointer; font-weight:600; }
  /* Cart panel (hidden by default). Will be toggled by cart button or view button */
  .cart-panel { position:fixed; right:18px; bottom:74px; width:340px; max-width:calc(100% - 36px); background:#fff; border-radius:14px; box-shadow:0 18px 40px rgba(10,20,40,0.12); padding:14px; z-index:1001; transition:transform .25s ease,opacity .25s ease; display:none; }
  .cart-header { display:flex; align-items:center; justify-content:space-between; gap:8px; }
  .cart-items { max-height:260px; overflow:auto; margin-top:8px; }
  .cart-item { display:flex; justify-content:space-between; gap:8px; padding:10px 0; border-bottom:1px solid #f1f3f8; }
  .total { font-weight:900; margin-top:12px; font-size:1.06rem; color:#1a237e; }
  .badge { background:#ff9900;color:#fff;padding:4px 8px;border-radius:999px;font-size:0.85rem; margin-left:6px; font-weight:700; }
  .back-link { display:inline-flex; align-items:center; gap:8px; text-decoration:none; color:#1a237e; border:1px solid #1a237e; padding:8px 12px; border-radius:10px; background:#fff; font-weight:700; font-family:'Montserrat',sans-serif;}
  /* Floating cart button */
  .cart-button {
    position:fixed;
    right:18px;
    bottom:18px;
    z-index:1002;
    width:58px;
    height:58px;
    border-radius:50%;
    background:#1a237e;
    color:#fff;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow:0 10px 30px rgba(10,20,40,0.18);
    cursor:pointer;
    border:none;
    font-size:20px;
  }
  .cart-button .cart-badge {
    position:absolute;
    top:-6px;
    right:-6px;
    background:#ff9900;
    color:#fff;
    min-width:22px;
    height:22px;
    padding:0 6px;
    border-radius:999px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:800;
    font-size:12px;
    box-shadow:0 4px 12px rgba(10,20,40,0.15);
  }
  /* mobile improvements */
  @media (max-width:900px){
    .container { margin:100px 12px 90px; }
    .cards{ grid-template-columns: repeat(2,minmax(0,1fr)); gap:12px; }
    .card{ padding:12px; border-radius:10px; }
    .floating-header { padding:10px 12px; }
    .cart-panel { right:12px; left:12px; bottom:74px; width:auto; border-radius:12px; padding:12px; }
    .cart-button { right:12px; bottom:12px; width:56px; height:56px; }
  }
  @media (max-width:520px){
    .cards{ grid-template-columns: 1fr; }
    .card{ padding:14px; }
    .add-controls { gap:6px; }
    .small, .btn { padding:10px; font-size:15px; }
    .floating-header .left a span { display:none; } /* hide text in header buttons to save space */
    header.main-head { padding:20px 12px; }
    .container { margin:90px 10px 140px; }
    .cart-panel { left:8px; right:8px; bottom:84px; width:auto; border-radius:12px; padding:12px; }
    .cart-button { right:8px; bottom:18px; width:56px; height:56px; }
  }

</style>
</head>
<body>
  
<div class="floating-header">
  <div class="floating-header-content">
    <div class="header-left">
      <img src="Logo.png" alt="Логотип Gruzim.kz" class="floating-logo">
      <div class="language-switcher">
        <a href="index.html" class="lang-btn active">РУС</a>
        <a href="indexkz.html" class="lang-btn">ҚАЗ</a>
      </div>
    </div>
    <a href="index.html" class="lang-btn shop-link">ГЛАВНАЯ</a>
    <a href="tel:+77767469606" class="header-phone">
      <i class="fas fa-phone"></i> +7 (776) 746-96-06
    </a>
  </div>
</div>

    <div class="right" style="display:flex;align-items:center;gap:12px;">
      <a href="tel:+77767469606" style="color:#fff;text-decoration:none;font-weight:700;"><i class="fas fa-phone"></i> +7 (776) 746-96-06</a>
    </div>
  </div>

  <div class="container">
    <header class="main-head">
      <h1>Магазин упаковочных материалов</h1>
      <p class="lead">Выбери нужные расходники для переезда. Цены можно редактировать прямо в этом файле (в блоке JSON).</p>
      <div style="margin-top:12px;"><a href="index.html" class="back-link">← На главную</a></div>
    </header>

    <script id="product-data" type="application/json">
[
  {
    "category": "Коробки",
    "items": [
      { "id": "box-small", "title": "Коробка малая", "size": "40×30×30 см", "price": 200, "unit": "шт" },
      { "id": "box-medium", "title": "Коробка средняя", "size": "60×40×40 см", "price": 350, "unit": "шт" },
      { "id": "box-clothes", "title": "Коробка для одежды (с перекладиной)", "size": "для одежды", "price": 700, "unit": "шт" }
    ]
  },
  {
    "category": "Упаковочная плёнка",
    "items": [
      { "id": "bubble-1m", "title": "Пузырчатая плёнка 1 м", "size": "1 м рулон", "price": 250, "unit": "рул" },
      { "id": "stretch-1kg", "title": "Стрейч-плёнка 1 кг", "size": "1 кг", "price": 300, "unit": "шт" }
    ]
  },
  {
    "category": "Скотч и ленты",
    "items": [
      { "id": "tape-50", "title": "Упаковочный скотч 50 мм", "size": "роль", "price": 120, "unit": "шт" }
    ]
  },
  {
    "category": "Сумки для переезда",
    "items": [
      { "id": "bag-small", "title": "Сумка для переезда (маленькая)", "size": "маленькая", "price": 600, "unit": "шт" },
      { "id": "bag-medium", "title": "Сумка для переезда (средняя)", "size": "средняя", "price": 900, "unit": "шт" },
      { "id": "bag-large", "title": "Сумка для переезда (большая)", "size": "большая", "price": 1200, "unit": "шт" }
    ]
  },
  {
    "category": "Наборы и услуги",
    "items": [
      { "id": "kit-econom", "title": "Набор эконом (3 коробки + скотч + плёнка)", "size": "набор", "price": 2500, "unit": "набор" },
      { "id": "service-packfrag", "title": "Упаковка хрупких вещей", "size": "услуга", "price": 2500, "unit": "усл" },
      { "id": "service-loader", "title": "Доп. грузчик (1 час)", "size": "час", "price": 2500, "unit": "час" }
    ]
  }
]
</script>

    <div id="catalog"></div>

    <p style="margin-top:26px;color:#666;font-size:0.95rem;">Подсказка: чтобы изменить цену, открой этот файл (shop_from_zero.html) в любом текстовом редакторе, найди блок &lt;script id="product-data"&gt; и измени число "price" для нужных товаров. Сохрани — и обнови страницу.</p>
  </div>

  <!-- Плавающая корзина (панель) -->
  <div id="cart" class="cart-panel" aria-hidden="true">
    <div class="cart-header">
      <strong>Корзина</strong>
      <div>
        <button id="clear-cart" class="small">Очистить</button>
        <button id="close-cart" class="small">✕</button>
      </div>
    </div>
    <div class="cart-items" id="cart-items"></div>
    <div>
      <div class="total" id="cart-total">Итого: 0 тг</div>
      <div style="margin-top:8px;">
        <input id="order-comment" placeholder="Адрес или комментарий (необязательно)" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6e9f2;margin-top:8px;">
      </div>
      <div style="margin-top:10px;display:flex;gap:8px;">
        <button id="checkout" class="btn whatsapp" style="flex:1;"><i class="fab fa-whatsapp"></i> Оформить через WhatsApp</button>
        <button id="view-cart-toggle" class="btn" style="background:#1a237e;">Показать</button>
      </div>
    </div>
  </div>

  <!-- Плавающая кнопка корзины (не разворачивает панель сама по себе) -->
  <button id="cart-button" class="cart-button" title="Открыть корзину" aria-label="Открыть корзину" style="display:none;">
    <i class="fas fa-shopping-cart"></i>
    <div id="cart-button-badge" class="cart-badge" style="display:none;">0</div>
  </button>

<script>
/* Загрузка товаров из JSON-блока (редактируй цены прямо в файле) */
function loadProductData(){
  try {
    const el = document.getElementById('product-data');
    if(!el) return [];
    return JSON.parse(el.textContent);
  } catch(e){
    console.error('product-data parse error', e);
    return [];
  }
}

let DATA = loadProductData();

/* CART in localStorage */
const CART_KEY = 'gruzim_shop_cart_v1';
let cart = {}; // {id: qty}

function saveCart(){ try{ localStorage.setItem(CART_KEY, JSON.stringify(cart)); }catch(e){} }
function loadCart(){ try{ const raw = localStorage.getItem(CART_KEY); if(raw) cart = JSON.parse(raw); else cart = {}; }catch(e){ cart = {}; } }
function cartCount(){ return Object.values(cart).reduce((s,n)=>s + (parseInt(n)||0), 0); }

function formatPrice(n){ return new Intl.NumberFormat('ru-RU').format(n) + ' тг'; }

/* Render catalog by categories */
function renderCatalog(){
  const wrap = document.getElementById('catalog');
  wrap.innerHTML = '';
  DATA.forEach(cat => {
    const section = document.createElement('section');
    section.className = 'category';
    const h = document.createElement('h2');
    h.textContent = cat.category;
    section.appendChild(h);

    const grid = document.createElement('div');
    grid.className = 'cards';
    cat.items.forEach(item=>{
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
         <div style="display:flex;align-items:center;justify-content:space-between;">
           <div>
             <strong>${item.title}</strong>
             <div class="meta">${item.size || ''}</div>
           </div>
           <div style="text-align:right;">
             <div class="price" data-id="${item.id}">${formatPrice(item.price)}</div>
           </div>
         </div>
         <div style="display:flex;align-items:center;justify-content:space-between;margin-top:6px;">
           <div class="meta">${item.unit}</div>
           <div class="add-controls">
             <button class="small dec" aria-label="Уменьшить количество" data-id="${item.id}">−</button>
             <span id="qty-${item.id}">${cart[item.id]||0}</span>
             <button class="small inc" aria-label="Увеличить количество" data-id="${item.id}">+</button>
             <button class="btn add" aria-label="Добавить в корзину" data-id="${item.id}" style="margin-left:8px;">Добавить</button>
           </div>
         </div>
      `;
      grid.appendChild(card);
    });
    section.appendChild(grid);
    wrap.appendChild(section);
  });
  updateBadgeTop();
}

/* CART UI */
function updateCartUI(){
  const panel = document.getElementById('cart');
  const itemsDiv = document.getElementById('cart-items');
  itemsDiv.innerHTML = '';
  const keys = Object.keys(cart);
  if(keys.length===0){
    itemsDiv.innerHTML = '<div style="color:#666">Корзина пуста</div>';
    document.getElementById('cart-total').textContent = 'Итого: 0 тг';
    // hide panel when empty and hide floating button
    panel.style.display = 'none';
    panel.setAttribute('aria-hidden','true');
  } else {
    let total = 0;
    keys.forEach(id=>{
      // find item
      let item = null;
      for(const cat of DATA){ item = cat.items.find(x=>x.id===id); if(item) break; }
      if(!item) return;
      const qty = cart[id];
      const row = document.createElement('div');
      row.className = 'cart-item';
      row.innerHTML = `
        <div>
          <div style="font-weight:700;">${item.title}</div>
          <div style="color:#666;font-size:0.95rem;">${formatPrice(item.price)} × ${qty}</div>
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px;">
          <div style="font-weight:700;">${formatPrice(item.price*qty)}</div>
          <div style="display:flex;gap:6px;">
            <button class="small dec" aria-label="Уменьшить количество" data-id="${id}">−</button>
            <button class="small inc" aria-label="Увеличить количество" data-id="${id}">+</button>
            <button class="small remove" aria-label="Удалить из корзины" data-id="${id}" style="color:#d00">✕</button>
          </div>
        </div>
      `;
      itemsDiv.appendChild(row);
      total += item.price * qty;
    });
    document.getElementById('cart-total').textContent = 'Итого: ' + formatPrice(total);
    // panel remains hidden until user opens it; do not force-open on add
    panel.setAttribute('aria-hidden','true');
  }
  // update small qty indicators in catalog
  DATA.forEach(cat=>{
    cat.items.forEach(i=>{
      const el = document.getElementById('qty-'+i.id);
      if(el) el.textContent = cart[i.id] || 0;
    });
  });
  updateBadgeTop();
}

/* Utilities to change cart */
function addToCart(id, qty=1){
  // don't auto-open panel anymore; just update cart
  cart[id] = (cart[id]||0) + qty;
  if(cart[id] <= 0) delete cart[id];
  saveCart(); updateCartUI(); updateBadgeTop();
  // small feedback without huge panel
  flashAddedFeedback(id);
}
function removeFromCart(id){ delete cart[id]; saveCart(); updateCartUI(); updateBadgeTop(); }
function changeQty(id, delta){
  cart[id] = (cart[id]||0) + delta;
  if(cart[id] <= 0) delete cart[id];
  saveCart(); updateCartUI(); updateBadgeTop();
}
function clearCart(){ cart = {}; saveCart(); updateCartUI(); updateBadgeTop(); }

/* Badge on header and floating button */
function updateBadgeTop(){
  const b = document.getElementById('badge-top');
  const count = cartCount();
  const cartButton = document.getElementById('cart-button');
  const cartBadge = document.getElementById('cart-button-badge');
  if(count>0){ 
    if(b){ b.style.display='inline-block'; b.textContent = count; } 
    if(cartButton){ cartButton.style.display='flex'; cartBadge.style.display='flex'; cartBadge.textContent = count; }
  } else { 
    if(b){ b.style.display='none'; } 
    if(cartButton){ cartButton.style.display='none'; cartBadge.style.display='none'; cartBadge.textContent = ''; }
  }
}

/* Small transient feedback when adding */
function flashAddedFeedback(id){
  // find add button and briefly change text
  const btn = document.querySelector('.btn.add[data-id="'+id+'"]');
  if(!btn) return;
  const orig = btn.textContent;
  btn.textContent = 'Добавлено';
  setTimeout(()=>{ btn.textContent = orig; }, 900);
}

/* Event bindings */
document.addEventListener('click', function(e){
  const btn = e.target;
  // button or inside button elements
  const addBtn = btn.closest ? btn.closest('.btn.add') : null;
  if(addBtn && addBtn.matches('.btn.add')){
    const id = addBtn.dataset.id; addToCart(id,1); return;
  }
  const inc = btn.closest ? btn.closest('.inc') : null;
  if(inc && inc.matches('.inc')){ const id = inc.dataset.id; changeQty(id,1); return; }
  const dec = btn.closest ? btn.closest('.dec') : null;
  if(dec && dec.matches('.dec')){ const id = dec.dataset.id; changeQty(id,-1); return; }
  const rem = btn.closest ? btn.closest('.small.remove') : null;
  if(rem && rem.matches('.small.remove')){ const id = rem.dataset.id; removeFromCart(id); return; }
  if(btn.id === 'clear-cart'){ if(confirm('Очистить корзину?')) clearCart(); return; }
  if(btn.id === 'close-cart'){ document.getElementById('cart').style.display='none'; document.getElementById('cart').setAttribute('aria-hidden','true'); return; }
  if(btn.id === 'view-cart-toggle'){ toggleCartPanel(true); return; }
  if(btn.id === 'checkout'){
    // build text
    const keys = Object.keys(cart);
    if(keys.length===0){ alert('Корзина пуста'); return; }
    let total=0; let text = 'Здравствуйте! Хочу заказать:%0A';
    keys.forEach(id=>{
      let item=null; for(const cat of DATA){ item = cat.items.find(x=>x.id===id); if(item) break; }
      if(!item) return;
      const qty = cart[id];
      text += `- ${item.title} × ${qty} — ${item.price} тг%0A`;
      total += item.price * qty;
    });
    text += `%0AИтого: ${total} тг%0A`;
    const comment = document.getElementById('order-comment').value.trim();
    if(comment) text += `%0AКомментарий: ${encodeURIComponent(comment)}%0A`;
    const url = 'https://wa.me/77767469606?text=' + encodeURIComponent(text);
    window.open(url, '_blank');
    return;
  }
  // cart button click (may be icon inside)
  const cartBtn = btn.closest ? btn.closest('#cart-button') : null;
  if(cartBtn && cartBtn.id === 'cart-button'){ toggleCartPanel(); return; }
});

/* Toggle cart panel visibility */
function toggleCartPanel(show){
  const panel = document.getElementById('cart');
  if(show === undefined) show = (panel.style.display === 'none' || panel.getAttribute('aria-hidden') === 'true');
  if(show){
    updateCartUI(); // refresh contents
    panel.style.display = 'block';
    panel.setAttribute('aria-hidden','false');
    // ensure panel is above cart button
    panel.focus && panel.focus();
  } else {
    panel.style.display = 'none';
    panel.setAttribute('aria-hidden','true');
  }
}

/* init */
loadCart();
renderCatalog();
updateCartUI();

/* attach cart-button behaviour */
(function(){
  const cb = document.getElementById('cart-button');
  if(cb){
    cb.addEventListener('keydown', function(e){ if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); toggleCartPanel(); } });
  }
})();
</script>

</body>
</html>
